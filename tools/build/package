#!/bin/bash
set -eu

###############################################################################
#
# usage and parameters
#
###############################################################################

function DieUsage {
    echo "usage: $0 <build_mode> <build_product> <sign_mode>" >&2
    echo " " >&2
    echo "<build_mode>: PUBLIC|PRIVATE" >&2
    echo "<build_client>: CLIENT|TEAM_SERVER" >&2
    echo "<sign_mode>: SIGNED|UNSIGNED" >&2
    echo " " >&2
    echo "example: $0 PRIVATE CLIENT UNSIGNED" >&2
    echo "example: $0 PUBLIC TEAM_SERVER UNSIGNED" >&2
    exit $ERRBADARGS
}

case ${1:-} in
    PUBLIC|PRIVATE) BUILD_MODE=$1;;
    *) DieUsage;;
esac
case ${2:-} in
    CLIENT|TEAM_SERVER) BUILD_PRODUCT=$2;;
    *) DieUsage;;
esac
case ${3:-} in
    SIGNED|UNSIGNED) SIGN_MODE=$3;;
    *) DieUsage;;
esac

include include/common $BUILD_MODE $BUILD_PRODUCT

#******************************************************************************
#******************************************************************************
#**
#** Run all of the build steps
#**
#******************************************************************************
#******************************************************************************

compute_next_release_version
echo '+---------------------------------------'
echo '| ' $RELEASE_VERSION $PRODUCT $MODE $SIGN_MODE
echo '+---------------------------------------'

call make_release_resources $MODE $PRODUCT $RELEASE_VERSION
call make_client_installers $MODE $PRODUCT $RELEASE_VERSION $SIGN_MODE
echo ">> successfully built $SIGN_MODE $MODE $PRODUCT release version $RELEASE_VERSION"
exit 0
