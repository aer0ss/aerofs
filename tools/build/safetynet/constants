#!/bin/bash -e -u

###############################################################################
#
# This include file contains all important constants for use with deploying
# SafetyNet.
#
# This file should be included with the following syntax:
#
# include safetynet/constants $MODE
#
###############################################################################

# Similar to an ifndef in the C preprocessor. Only includes the contents of this
# file if they weren't imported before.
if [ x"${__SAFETYNET_CONSTANTS_INCLUDE__:-}" == x ] ; then readonly __SAFETYNET_CONSTANTS_INCLUDE__=true

include include/common $1

readonly ERRSAFETYNET=30

###############################################################################
#
# S3 constants
#
###############################################################################
readonly SAFETYNET_INSTALLER_BUCKET="s3://nocache.client.safetynet.aerofs.com"

###############################################################################
#
# SyncDET constants
#
###############################################################################
readonly SYNCDET="${GIT_ROOT}/../syncdet/syncdet.py"
readonly SAFETYNET_CONFIG_PATH_TEMPLATE="${BUILD_SCRIPT_DIR}/safetynet/config.yaml"
readonly SAFETYNET_SYNCDET_DEPLOY_DIR="${BUILD_SCRIPT_DIR}/safetynet/syncdet_deploy"

###############################################################################
#
# Create a replica of the SyncDET config file with the updated ip address of the
# controller. This file will be deleted on exit.
#
# @param $1 The variable that will hold the resulting config file path
#
###############################################################################
function create_updated_config_file() {
    local local_UPDATED_CONFIG="$(mktemp -t syncdet_config)"
    trap "rm \"$local_UPDATED_CONFIG\"" EXIT
    "${BUILD_SCRIPT_DIR}/safetynet/update_syncdet_ip.py" "$SAFETYNET_CONFIG_PATH_TEMPLATE" "$local_UPDATED_CONFIG"
    eval "$1='$local_UPDATED_CONFIG'"
}

###############################################################################
#
# Command server constants
#
###############################################################################
if is_prod ; then
    readonly COMMAND_SERVER="sv.aerofs.com"
else
    readonly COMMAND_SERVER="ec2-50-17-173-65.compute-1.amazonaws.com"
fi
readonly SAFETYNET_CMD_TTL=1

fi # endif
