#!/bin/bash

# This script creates the approot directory and populates it
# with the files needed for a staging AeroFS

# usage: $0 <approot> <as-is>
#   where <approot> is the approot folder path which doesn't need to pre-exist,
#   and <as-is> is the as-is folder path which must exist.

set -e

if [ x"$1" == x ]; then
    echo "usage: $0 <approot> <as-is>"
    exit 1
fi
APPROOT="$1"
ASIS="$2"

PPWD=`dirname $0`
OS=`"$PPWD"/os`

# Copy files to approot
mkdir -p "$APPROOT"
rm -rf "$APPROOT"/Growl.framework    # Symlinks prevent cp from overwriting the files
cp -R "$ASIS"/common/* "$APPROOT"/
cp -R "$ASIS"/$OS/* "$APPROOT"/

# Set-up a staging environment
touch "$APPROOT"/staging
echo "100.0.0" > "$APPROOT"/aerofs.ver
rm "$APPROOT"/cacert-prod.pem
mv "$APPROOT"/cacert-staging.pem "$APPROOT"/cacert.pem

# Add the run script.
cp "$PPWD/os" "$PPWD/run" "$APPROOT"/

