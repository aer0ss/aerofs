<div id="layer"></div>
<div id="popup">
  <div id="popup-container">
    {% if number_search_results > 0 %}
      <hgroup>
        <h2>We have not posted your question yet</h2>
        <h4>Perhaps one of these articles will help you get your answer...</h4>
        <p>(Clicking these links will open a new window)</p>
      </hgroup>
      <section>
        {% for result in search_results limit:3 %}
          <section class="theme-bkg">
            <h2 class="{% if result.class_name == "Question" %} ask-question {% else %} file {% endif %}"><a href="{{ result.public_url }}" target='_blank'>{{ result.subject_plain | clip:70 }}</a></h2>
            <p> {{ result.body_plain | clip:105 }}</p>
          </section>
        {% endfor %}
        <footer>
          {{form_begin}}
            These Didn’t Help? <input class="button-sm" id='question_submit' name='commit' type='submit' value='Post your Question' />
            <img alt='Ajax-loader-small' id='question_submit_spinner' src='{{ "/images/ajax-loader-small.gif" | portal_image_url: image_asset_host }}' style='display: none; margin: 7px 0 0 5px; position: absolute;' />
          {{form_end}}
          <script type='text/javascript'>
                  //<![CDATA[
                  jQuery(document).ready(function() {
                    $('#question_submit').click(function() {
                      $(this).addClass('disabled');
                    })
                  });
                  {% if number_search_results == 0 %}
                    jQuery('#new_question').submit();
                  {% endif %}
                  highlightSearchTerms('{{ search_term }}');
                  //]]>
                </script>
        </footer>
      </section>
    {% else %}
      <h2>Please wait while your question is submitted...</h2>
    {% endif %}
  </div>
</div>
<nav id="main-nav"><a href="">Home</a> › Post a Question</nav>
<div id="main" class="blog">
  <section>
    <h2 class="ask">Post a Question</h2>
    <section class="theme-bkg">
      {{form_begin}}
        <ul class="form">
          <li>
            <label>Topic
              <select id='qna_kb_topic_id' name='qna[kb_topic_id]'>
                        {% for topic in topics %}
                        <option value='{{ topic.id }}'>{{ topic.name | clip:30 }}</option>
                        {% endfor %}
                      </select>
            </label>
          </li>
          {% if current_user.is_guest %}
          <li>
            <label>Your name (required)
              <input id='interaction_name' value='{{ interaction.name }}' maxlength='100' name='interaction[name]' type='text' />
            </label>
          </li>
          <li>
            <label>Your email address (required)
              <input id='interaction_email' value='{{ interaction.email }}' maxlength='100' name='interaction[email]' type='text' />
            </label>
          </li>
          {% endif %}
          <li>
            <label>Subject (required)
              <input id='qna_subject' maxlength='100' name='qna[subject]' type='text' value='{% if search_term and search_term != '' %}{{search_term}}{% else %}{{qna.subject}}{%endif%}' />
            </label>
          </li>
          <li>
            <label>What is your question? (required)
              <textarea id='qna_body' name='qna[body]'>{{qna.body}}</textarea>
            </label>
          </li>
          <li>
            <input class="button-sm" id='question_submit' name='commit' type='submit' value='Ask Question' />
                  <img alt='Ajax-loader-small' id='question_submit_spinner' src='{{ "/images/ajax-loader-small.gif" | portal_image_url: image_asset_host }}' style='display: none; margin: 7px 0 0 5px; position: absolute;' />
          </li>
        </ul>
      {{form_end}}
      <script type='text/javascript'>
        //<![CDATA[
        $('#qna_body').textarea_maxlength();
        $('#new_question').validate({
          submitHandler: function(form) {
            $('#question_submit').attr('disabled',true);
            $('#question_submit').addClass('disabled');
            $('#question_submit_spinner').show();
            form.submit();
          },
          messages:{
            'interaction[name]':{
              'required':'Name is required.'
            },
            'interaction[email]':{
              'required':'Email address is required.',
              'email':'Invalid email address'
            },
            'qna[subject]':{
              'required':'Subject is required.'
            },
            'qna[body]':{
              'required':'Question is required.',
              'maxlength':'Exceeding max length of 5KB'
            }
          },
          rules:{
            'interaction[name]':{
              'required':true
            },
            'interaction[email]':{
              'required':true,
              'email':true
            },
            'qna[subject]':{
              'required':true,
              'invalidchars':'<>'
            },
            'qna[body]':{
              'required':true,
              'maxlength':5000,
              'invalidchars':'<>'
            }
          },
          errorClass:'invalid'
        });
        //]]>
      </script>
    </section>
  </section>
</div>
