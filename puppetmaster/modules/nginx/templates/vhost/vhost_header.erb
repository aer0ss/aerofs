server {
  listen <%= listen_ip %>:<%= listen_port %>; 
  <% # check to see if ipv6 support exists in the kernel before applying %>
  <% if ipv6_enable == 'true' && (defined? ipaddress6) %>listen [<%= ipv6_listen_ip %>]:<%= ipv6_listen_port %> default ipv6only=on;<% end %>
  server_name <%= name %>;
  access_log <%= scope.lookupvar('nginx::params::nx_logdir')%>/<%= name %>.access.log;

  <% if ssl == 'true' %>ssl on;
  ssl_certificate <%= ssl_cert %>;
  ssl_certificate_key <%= ssl_key %>;
  ssl_client_certificate <%= ssl_client_cert %>;
  ssl_verify_client optional;
  ssl_session_timeout 5m;

  ssl_protocols SSLv3 TLSv1 TLSv1.1 TLSv1.2;
  ssl_ciphers RC4:HIGH:!aNULL:!MD5;
  ssl_prefer_server_ciphers on;
  <% end %>
