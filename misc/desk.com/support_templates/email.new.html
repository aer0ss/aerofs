<nav id="main-nav"><a href="{{home_link}}">Home</a> â€º Email Us</nav>
<div id="main" class="blog">
  <section>
    <h2 class="contact">Email Us</h2>
    <section class="theme-bkg">
      {{form_begin}}
        <ul class="form">
          {% if current_user.is_guest %}
          <li>
            <label>Your name (required)
              <input id='interaction_name' value='{{ interaction.name }}' maxlength='100' name='interaction[name]' type='text' />
            </label>
          </li>
          <li>
            <label>Your email address (required)
              <input id='interaction_email' value='{{ interaction.email }}' maxlength='100' name='interaction[email]' type='text' />
            </label>
          </li>
          {% endif %}
          <li>
            <label>Subject (required)
             <input id='email_subject' maxlength='100' name='email[subject]' type='text' value='{% if search_term and search_term != '' %}{{search_term}}{% else %}{{email.subject}}{%endif%}'/>
            </label>
          </li>
          <li>
            <label>What is your question? (required)
              <textarea id='email_body' name='email[body]'>{{email.body}}</textarea>
            </label>
          </li>
          <li>
            <label>File Attachment
              <input name="ticket_attachment[attachment]" size="46" type="file"/>
            </label>
          <li>
            <input class="button-small" id='email_submit' name='commit' type='submit' value='Send Email' />
                  <img alt='Ajax-loader-small' id='email_submit_spinner' src='{{ "/images/ajax-loader-small.gif" | portal_image_url: image_asset_host }}' style='display: none; margin: 7px 0 0 5px; position: absolute;' />
          </li>
        </ul>
      {{form_end}}
      <script type='text/javascript'>
            //<![CDATA[
            $('#email_body').textarea_maxlength();
            $('#new_email').validate({
              submitHandler: function(form) {
                $('#email_submit').attr('disabled',true);
                $('#email_submit').addClass('disabled');
                $('#email_submit_spinner').show();
                form.submit();
              },
              messages:{
                'interaction[name]':{
                  'required':'Name is required.'
                },
                'interaction[email]':{
                  'required':'Email address is required.',
                  'email':'Invalid email address'
                },
                'email[subject]':{
                  'required':'Subject is required.'
                },
                'email[body]':{
                  'required':'Message is required.',
                  'maxlength':'Exceeding max length of 5KB'
                }
              },
              rules:{
                'interaction[name]':{
                  'required':true
                },
                'interaction[email]':{
                  'required':true,
                  'email':true
                },
                'email[subject]':{
                  'required':true,
                  'invalidchars':''
                },
                'email[body]':{
                  'required':true,
                  'maxlength':5000,
                  'invalidchars':''
                }
              },
              errorClass:'invalid'
            });
            //]]>
          </script>
    </section>
  </section>
</div>
