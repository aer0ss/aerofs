# test if the specified filesystem on the specified remote host exceeds 90
#
# usage: $0 <user@host> <port> <filesystem, e.g. rootfs>
#
# exit 1 if the usage exceeds 90%
# exit 2 if the hostname or filesystem is not found
# exit 3 if bad arguments

if [ $# != 3 ]; then
    echo bad arguments
    exit 3
fi

LOGIN=$1
PORT=$2
FS=$3
THRESHOLD=90

USED=`kssh -p $PORT $LOGIN df | grep $FS | awk '{print $5}' | sed -e 's/%//'`

if [ x$USED == x ]; then
    # the filesystem is not found
    exit 2
fi

if [ `expr $USED \>= $THRESHOLD` == 1 ]; then
    exit 1
else
    exit 0
fi
